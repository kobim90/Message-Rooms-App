(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{125:function(e,t,n){},128:function(e,t,n){},213:function(e,t,n){},214:function(e,t,n){},216:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),r=n(49),s=n.n(r),o=(n(98),n(6)),i=n.n(o),l=n(20),u=n(15),j=n(10),d=n(5),b=n(51),m=n.n(b),O=n(32),p=n.n(O),h=n(52),f=n.n(h),x="REGISTER_SUCCESS",v="REGISTER_FAIL",g="LOGIN_SUCCESS",N="LOGIN_FAIL",y="LOGOUT",w="SET_MESSAGE",S="CLEAR_MESSAGE",k="SET_SOCKET",I=n(54),E=n.n(I);function C(){var e=JSON.parse(localStorage.getItem("user"));return e&&e.accessToken?{"x-access-token":e.accessToken}:{}}var L="https://rooms-message-app.herokuapp.com/auth/",R=function(){var e=Object(l.a)(i.a.mark((function e(t,n,c){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("services"),e.next=3,E.a.post(L+"signup",{username:t,email:n,password:c});case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e)})));return function(t,n,c){return e.apply(this,arguments)}}(),T=function(){var e=Object(l.a)(i.a.mark((function e(t,n){var c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post(L+"signin",{username:t,password:n});case 2:return(c=e.sent).data.accessToken&&localStorage.setItem("user",JSON.stringify(c.data)),e.abrupt("return",c.data);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.get(L+"rooms",{headers:C()});case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A={register:R,login:T,logout:function(){localStorage.removeItem("user")},getRooms:U},F=function(e,t,n){return function(){var c=Object(l.a)(i.a.mark((function c(a){var r,s;return i.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,A.register(e,t,n);case 3:return r=c.sent,a({type:x}),a({type:w,payload:r.message}),c.abrupt("return",Promise.resolve());case 9:return c.prev=9,c.t0=c.catch(0),s=c.t0.response&&c.t0.response.data&&c.t0.response.data.message||c.t0.message||c.t0.toString(),a({type:v}),a({type:w,payload:s}),c.abrupt("return",Promise.reject());case 15:case"end":return c.stop()}}),c,null,[[0,9]])})));return function(e){return c.apply(this,arguments)}}()},G=function(e,t){return function(){var n=Object(l.a)(i.a.mark((function n(c){var a,r;return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,A.login(e,t);case 3:return a=n.sent,c({type:g,payload:{user:a}}),n.abrupt("return",Promise.resolve());case 8:return n.prev=8,n.t0=n.catch(0),r=n.t0.response&&n.t0.response.data&&n.t0.response.data.message||n.t0.message||n.t0.toString(),c({type:N}),c({type:w,payload:r}),n.abrupt("return",Promise.reject());case 14:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}()},P=n(34),_=(n(125),n(0)),J=function(){return Object(_.jsxs)("div",{className:"row",children:[Object(_.jsx)("div",{className:"col-6 btn-nav-l",children:Object(_.jsx)(P.a,{to:"/login",children:Object(_.jsx)("div",{className:"d-grid gap-2",children:Object(_.jsx)("button",{className:"btn btn-primary btn-nav no-radius",type:"button",children:Object(_.jsx)("strong",{children:"LOGIN"})})})})}),Object(_.jsx)("div",{className:"col btn-nav-r",children:Object(_.jsx)(P.a,{to:"/register",children:Object(_.jsx)("div",{className:"d-grid gap-2",children:Object(_.jsx)("button",{className:"btn btn-primary btn-nav no-radius",type:"button",children:Object(_.jsx)("strong",{children:"REGISTER"})})})})})]})},M=(n(128),function(e){return Object(_.jsx)("div",{className:"wrapper-main container",children:Object(_.jsx)("div",{className:"row justify-content-center align-items-center mt-5",children:Object(_.jsx)("div",{className:"col-sm-10 col-lg-6 wrapper",children:e.children})})})}),D=n(86),z=function(e){if(!e)return Object(_.jsx)("small",{className:"text-danger",children:"This field is required!"})},H=function(e){if(!Object(D.isEmail)(e))return Object(_.jsx)("small",{className:"text-danger",children:"This is not a valid email."})},q=function(e){if(e.length<3||e.length>20)return Object(_.jsx)("small",{className:"text-danger",children:"The username must be between 3 and 20 characters."})},B=function(e){if(e.length<6||e.length>40)return Object(_.jsx)("small",{className:"text-danger",children:"The password must be between 6 and 40 characters."})},K=(n(84),function(e){var t=Object(c.useRef)(),n=Object(c.useRef)(),a=Object(c.useState)(""),r=Object(u.a)(a,2),s=r[0],o=r[1],b=Object(c.useState)(""),O=Object(u.a)(b,2),h=O[0],x=O[1],v=Object(c.useState)(!1),g=Object(u.a)(v,2),N=g[0],y=g[1],w=Object(j.c)((function(e){return e.auth})).isLoggedIn,S=Object(j.c)((function(e){return e.message})).message,k=Object(j.b)(),I=function(){var e=Object(l.a)(i.a.mark((function e(c){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c.preventDefault(),y(!0),t.current.validateAll(),0!==n.current.context._errors.length){e.next=9;break}return e.next=7,k(G(s,h));case 7:e.next=10;break;case 9:y(!1);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),y(!1);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}();return w?Object(_.jsx)(d.a,{to:"/home"}):Object(_.jsxs)(M,{children:[Object(_.jsx)(J,{}),Object(_.jsx)("div",{children:Object(_.jsxs)(m.a,{onSubmit:I,ref:t,children:[Object(_.jsx)("div",{className:"form-group",children:Object(_.jsx)(p.a,{type:"text",placeholder:"Username",className:"form-control",name:"username",value:s,onChange:function(e){var t=e.target.value;o(t)},validations:[z]})}),Object(_.jsx)("div",{className:"form-group",children:Object(_.jsx)(p.a,{type:"password",placeholder:"Password",className:"form-control",name:"password",value:h,onChange:function(e){var t=e.target.value;x(t)},validations:[z]})}),Object(_.jsxs)("div",{className:"d-grid gap-2",children:[Object(_.jsx)("button",{className:"btn btn-primary btn-block mt-2",children:Object(_.jsx)("span",{children:"Login"})}),N&&Object(_.jsx)("div",{className:"row justify-content-center",children:Object(_.jsx)("div",{className:"spinner-border text-primary",role:"status",children:Object(_.jsx)("span",{className:"visually-hidden",children:"Loading..."})})})]}),S&&Object(_.jsx)("div",{className:"form-group",children:Object(_.jsx)("div",{className:"alert alert-danger",role:"alert",children:S})}),Object(_.jsx)(f.a,{style:{display:"none"},ref:n})]})})]})}),V=n(38),W=n(21),Q=n(7),X=JSON.parse(localStorage.getItem("user")),Y=X?{isLoggedIn:!0,user:X}:{isLoggedIn:!1,user:null},Z=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,n=arguments.length>1?arguments[1]:void 0,c=n.type,a=n.payload,r=(e={},Object(W.a)(e,x,Object(Q.a)(Object(Q.a)({},t),{},{isLoggedIn:!1})),Object(W.a)(e,v,Object(Q.a)(Object(Q.a)({},t),{},{isLoggedIn:!1})),Object(W.a)(e,g,Object(Q.a)(Object(Q.a)({},t),{},{isLoggedIn:!0,user:a?a.user:void 0})),Object(W.a)(e,N,Object(Q.a)(Object(Q.a)({},t),{},{isLoggedIn:!1,user:null})),Object(W.a)(e,y,Object(Q.a)(Object(Q.a)({},t),{},{isLoggedIn:!1,user:null})),e);return r[c]?r[c]:t},$={},ee=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$,n=arguments.length>1?arguments[1]:void 0,c=n.type,a=n.payload,r=(e={},Object(W.a)(e,w,{message:a}),Object(W.a)(e,S,{message:""}),e);return r[c]?r[c]:t},te={},ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=arguments.length>1?arguments[1]:void 0,n=t.type,c=t.payload,a=Object(W.a)({},k,Object(Q.a)(Object(Q.a)({},e),{},{socket:c?c.socket:null}));return a[n]?a[n]:e},ce=Object(V.combineReducers)({auth:Z,message:ee,socket:ne}),ae=n(87),re=[n(88).a],se=Object(V.createStore)(ce,Object(ae.composeWithDevTools)(V.applyMiddleware.apply(void 0,re))),oe=function(){var e=Object(c.useRef)(),t=Object(c.useRef)(),n=Object(c.useState)(""),a=Object(u.a)(n,2),r=a[0],s=a[1],o=Object(c.useState)(""),d=Object(u.a)(o,2),b=d[0],O=d[1],h=Object(c.useState)(""),x=Object(u.a)(h,2),v=x[0],g=x[1],N=Object(c.useState)(!1),y=Object(u.a)(N,2),w=y[0],S=y[1],k=Object(j.c)((function(e){return e.message})).message,I=Object(j.b)(),E=function(){var n=Object(l.a)(i.a.mark((function n(c){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,c.preventDefault(),S(!1),e.current.validateAll(),0!==t.current.context._errors.length){n.next=8;break}return n.next=7,I(F(r,b,v));case 7:S(!0);case 8:n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),S(!1);case 13:case"end":return n.stop()}}),n,null,[[0,10]])})));return function(e){return n.apply(this,arguments)}}();return Object(_.jsxs)(M,{children:[Object(_.jsx)(J,{}),Object(_.jsxs)(m.a,{onSubmit:E,ref:e,children:[!w&&Object(_.jsxs)("div",{children:[Object(_.jsx)("div",{className:"form-group",children:Object(_.jsx)(p.a,{type:"text",placeholder:"Username",className:"form-control",name:"username",value:r,onChange:function(e){var t=e.target.value;s(t)},validations:[z,q]})}),Object(_.jsx)("div",{className:"form-group",children:Object(_.jsx)(p.a,{type:"text",placeholder:"Email",className:"form-control",name:"email",value:b,onChange:function(e){var t=e.target.value;O(t)},validations:[z,H]})}),Object(_.jsx)("div",{className:"form-group",children:Object(_.jsx)(p.a,{type:"password",placeholder:"Password",className:"form-control",name:"password",value:v,onChange:function(e){var t=e.target.value;g(t)},validations:[z,B]})}),Object(_.jsx)("div",{className:"d-grid gap-2",children:Object(_.jsx)("button",{className:"btn btn-primary mt-2",children:"Sign Up"})})]}),k&&Object(_.jsx)("div",{className:"form-group",children:Object(_.jsx)("div",{className:w?"alert alert-success":"alert alert-danger",role:"alert",children:k})}),Object(_.jsx)(f.a,{style:{display:"none"},ref:t})]})]})},ie=n(92),le=function(){return function(e){var t=Object(ie.a)("https://rooms-message-app.herokuapp.com/",{auth:{token:JSON.parse(localStorage.getItem("user")).accessToken},Headers:"Access-Control-Allow-Origin"});e({type:k,payload:{socket:t}})}},ue=n(44),je=n(28),de=n(16),be=n(218),me=(n(213),function(e){var t=e.chatroomId,n=e.chatroomName,a=e.roomLeaveHandler,r=Object(j.c)((function(e){return e.socket})).socket,s=Object(j.c)((function(e){return e.auth})).user,o=Object(c.useState)([]),i=Object(u.a)(o,2),l=i[0],d=i[1],b=Object(c.useState)(""),m=Object(u.a)(b,2),O=m[0],p=m[1],h=Object(c.useRef)(null),f=function(){if(""!==O.trim()){var e={id:Object(be.a)(),userId:s.id,username:s.username,text:O,delivered:!1,seen:!1};r.emit("chat",Object(Q.a)(Object(Q.a)({},e),{},{room:t})),p(""),d((function(t){return[].concat(Object(ue.a)(t),[e])}))}};return Object(c.useEffect)((function(){r.on("message",(function(e){d((function(t){return[].concat(Object(ue.a)(t),[e])}))}))}),[]),Object(c.useEffect)((function(){r.on("message1",(function(e){d((function(t){var n=Object(ue.a)(t);return console.log(t[t.length-1].delivered),t[t.length-1].id===e.id&&t[t.length-1].delivered!==e.delivered&&n.pop(),[].concat(Object(ue.a)(n),[e])}))}))}),[r]),Object(c.useEffect)((function(){h.current.scrollIntoView({behavior:"smooth"})}),[l]),Object(c.useEffect)((function(){d([])}),[t]),Object(_.jsx)(_.Fragment,{children:Object(_.jsxs)("div",{className:"chat container-fluid",children:[Object(_.jsx)("div",{children:Object(_.jsx)("div",{className:"row room-name",children:Object(_.jsx)("h2",{children:Object(_.jsxs)("span",{style:{marginLeft:"1rem"},children:["".concat(n[0].toUpperCase()).concat(n.slice(1)),":"]})})})}),Object(_.jsxs)("div",{className:"chat-message",children:[l.map((function(e){return e.username===s.username?Object(_.jsx)("div",{className:"row",children:Object(_.jsx)("div",{className:"message col-sm-auto",children:Object(_.jsxs)("p",{children:[e.text,Object(_.jsx)("span",{children:e.delivered?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(je.a,{icon:de.a}),Object(_.jsx)(je.a,{icon:de.a})]}):Object(_.jsx)(je.a,{icon:de.a})})]})})}):Object(_.jsxs)("div",{className:"row",children:[Object(_.jsx)("div",{className:"col"}),Object(_.jsxs)("div",{className:"message mess-right col-sm-auto",children:[Object(_.jsx)("span",{children:e.username}),Object(_.jsxs)("p",{children:[e.text,Object(_.jsx)("span",{children:e.delivered?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(je.a,{icon:de.a}),Object(_.jsx)(je.a,{icon:de.a})]}):Object(_.jsx)(je.a,{icon:de.a})})," "]})]})]})})),Object(_.jsx)("div",{ref:h})]}),Object(_.jsxs)("div",{class:"input-group send-message",children:[Object(_.jsx)("input",{type:"text",value:O,onChange:function(e){return p(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&f()},class:"form-control",placeholder:"Message"}),Object(_.jsx)("button",{class:"btn btn-success btn-chat",type:"button",onClick:f,children:"Send"}),Object(_.jsx)("button",{class:"btn btn-danger btn-chat",onClick:function(){r.emit("leaveRoom",{chatroomId:t,currentUser:s}),a()},type:"button",children:"Leave Room"})]})]})})}),Oe=(n(214),function(){var e=Object(j.c)((function(e){return e.auth})).user,t=Object(j.c)((function(e){return e.socket})).socket,n=Object(c.useState)([]),a=Object(u.a)(n,2),r=a[0],s=a[1],o=Object(c.useState)({}),d=Object(u.a)(o,2),b=d[0],m=d[1],O=Object(j.b)(),p={news:de.e,sports:de.b,gaming:de.c,medicine:de.g,coding:de.d},h=function(){var e=Object(l.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A.getRooms();case 3:t=e.sent,s((function(e){return t})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){O(le()),h()}),[]),Object(_.jsx)("div",{className:"container",children:Object(_.jsx)("div",{className:"test row main justify-content-center align-items-center",children:Object(_.jsxs)("div",{className:"row main-wrapper",children:[Object(_.jsxs)("div",{className:"col-sm-12 col-md-auto",children:[Object(_.jsxs)("div",{className:"user-row",children:[Object(_.jsxs)("div",{className:"avatar",children:[Object(_.jsx)(je.a,{icon:de.h,size:"3x"}),Object(_.jsx)("h3",{children:Object(_.jsx)("strong",{children:e.username.toUpperCase()})})]}),Object(_.jsx)("button",{onClick:function(){t.disconnect(),O((function(e){A.logout(),e({type:y})}))},children:Object(_.jsx)(je.a,{icon:de.f,size:"2x"})})]}),Object(_.jsx)("ul",{class:"list-group list-group-flush",children:r.map((function(n,c){return Object(_.jsx)("button",{className:"room-button",onClick:function(c){return a=n.id,r=n.name,b.id&&t.emit("leaveRoom",{chatroomId:b.id}),void(b.id!==a&&(t.emit("joinRoom",{chatroomId:a,currentUser:e}),m({id:a,name:r})));var a,r},children:Object(_.jsxs)("li",{class:"list-group-item rooms",children:[Object(_.jsx)("p",{className:"room-icon",children:Object(_.jsx)(je.a,{icon:p[n.name],size:"2x"})}),Object(_.jsxs)("div",{children:[Object(_.jsx)("strong",{children:"".concat(n.name[0].toUpperCase()).concat(n.name.slice(1))}),Object(_.jsx)("p",{className:"room-description",children:n.description})]})]},c)})}))})]}),Object(_.jsx)("div",{className:"col equal",children:b.name&&Object(_.jsx)(me,{chatroomId:b.id,chatroomName:b.name,roomLeaveHandler:function(){m({})}})})]})})})}),pe=n(93),he=["component"],fe=function(e){var t=e.component,n=Object(pe.a)(e,he),c=Object(j.c)((function(e){return e.auth})).user;return Object(_.jsx)(d.b,Object(Q.a)(Object(Q.a)({},n),{},{render:function(){return c?Object(_.jsx)(t,{}):Object(_.jsx)(d.a,{to:"/login"})}}))},xe=n(14),ve=Object(xe.a)();n(215);function ge(){var e=Object(j.b)();return Object(c.useEffect)((function(){ve.listen((function(t){e({type:S})}))}),[e]),Object(_.jsx)(d.c,{history:ve,children:Object(_.jsxs)(d.d,{children:[Object(_.jsx)(d.b,{exact:!0,path:["/","/login"],component:K}),Object(_.jsx)(d.b,{exact:!0,path:"/register",component:oe}),Object(_.jsx)(fe,{path:"/home",component:Oe}),Object(_.jsx)(fe,{path:"/chatroom/:chatroomName/:chatroomId",component:me})]})})}var Ne=function(){return Object(_.jsx)(j.a,{store:se,children:Object(_.jsx)(ge,{})})},ye=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,219)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),c(e),a(e),r(e),s(e)}))};s.a.render(Object(_.jsx)(a.a.StrictMode,{children:Object(_.jsx)(Ne,{})}),document.getElementById("root")),ye()},84:function(e,t,n){},98:function(e,t,n){}},[[216,1,2]]]);
//# sourceMappingURL=main.83aba8bf.chunk.js.map